---
title: "Tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Tutorial
========

The best way to interact with the network is to instantiate a ``Buyer`` object with the `new_buyer()` function.


## Querying health datasets

Executing a query :
For executing a query, we get the api key and ip address from the web dashboard and then create a
``Buyer`` instance and then call a query method on that buyer instance with a SQL query string and then print recieved query accuracy and results.


``` r
source("sdk.r")

api_key <- "buyer_key"
ip_addr <- "127.0.0.1"


buyer <- new_buyer(api_key, ip_addr)

# retrieve the query sub key
query_key <- get_key(buyer)
print(query_key)


# Initiate a query
sql_query <- "select count(*) as numpeople from public.condition_era_death"
result <- query(buyer, query_key, sql_query)

sql_query <- "select count(*) as people_per_condition from person"
result <- query(buyer, query = sql_query)

# execution result and accuracy of the query
#  -- add proper result indexing subscript here

```


## NOTE!! : Related to SQL querying rules
- allowed: Group by, selection of count, sum/min/max/avg of limited columns, of raw columns that are the group-by columns, any where conditions
- not allowed: join, selection of columns that arent in the group by, arbitrary sum/min/max/avgs



## Pretty print query history

``` r

print_query_history(buyer)


"+------------------------------------------------------------------------------------------+"
"select count(*) as numpeople from public.condition_era_death"
"list(list(\"numpeople\"), list(30297))"
"Results of this query can be expected to be within: 0.01% of the true value with 95% probability"
"+------------------------------------------------------------------------------------------+"
"select count(*) as people_per_condition from person"
"list(list(\"people_per_condition\"), list(2000000))"
"Results of this query can be expected to be within: 0.0% of the true value with 95% probability"

```

## Get queryable table columns 